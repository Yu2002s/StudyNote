[Pinia](https://pinia.vuejs.org/) 是 Vue 的专属状态管理库，它允许你跨组件或页面共享状态。如果你熟悉组合式 API 的话，你可能会认为可以通过一行简单的 `export const state = reactive({})` 来共享一个全局状态。对于单页应用来说确实可以，但如果应用在服务器端渲染，这可能会使你的应用暴露出一些安全漏洞。 而如果使用 Pinia，即使在小型单页应用中，你也可以获得如下功能：

- Devtools 支持
  - 追踪 actions、mutations 的时间线
  - 在组件中展示它们所用到的 Store
  - 让调试更容易的 Time travel
- 热更新
  - 不必重载页面即可修改 Store
  - 开发时可保持当前的 State
- 插件：可通过插件扩展 Pinia 功能
- 为 JS 开发者提供适当的 TypeScript 支持以及**自动补全**功能。
- 支持服务端渲染

### 使用示例

1.对象方式定义（选项式）

```ts
// 使用一个对象来定义store
export const useCounterStore = defineStore("counter", {
  state: () => ({count: 0}),
  actions: {
    increment() {
      this.count++
    }
  }
})
```

2.函数方式定义（组合式）

```ts
// 使用一个函数定义store
export const useCounterStore = defineStore('counter', () => {
  const count = ref(0)

  function increment() {
    count.value++
  }

  return {
    count, increment
  }
})
```

### 在组件中使用

```vue
<script lang="ts" setup>
import { useCounterStore } from '@/stores/counter'

const counter = useCounterStore()

// 订阅
counter.$subscribe((mutation, state) => {
  console.log(mutation, state)
})

// 直接使用变量进行自加一
counter.count++

// 使用内部方法进行自加一
counter.$patch({ count: counter.count + 1 })

// 使用actions进行自加一
counter.increment()

// 重置值
counter.$reset()

// 同时修改多个值
counter.$patch(state => {
  state.count = 1
  state.items.push({name: '123', email: '123'})
})
</script>

<template>
  <div>{{ counter.count }}
    {{ counter.items }}
    <button @click="counter.count ++">+1</button>
  </div>
</template>

<style scoped>

</style>

```

### 选项式属性解析

1. state: 状态元数据

```ts
import { defineStore } from 'pinia'

const useStore = defineStore('storeId', {
  // 为了完整类型推理，推荐使用箭头函数
  state: () => {
    return {
      // 所有这些属性都将自动推断出它们的类型
      count: 0,
      name: 'Eduardo',
      isAdmin: true,
      items: [],
      hasChanged: true,
    }
  },
})
```

2. getter: 相当于计算属性

```ts
export const useStore = defineStore('main', {
  state: () => ({
    count: 0,
  }),
  getters: {
    // 自动推断出返回类型是一个 number
    doubleCount(state) {
      return state.count * 2
    },
    // 返回类型**必须**明确设置
    doublePlusOne(): number {
      // 整个 store 的 自动补全和类型标注 ✨
      return this.doubleCount + 1
    },
  },
})
```

3. actions: 相当于methods

### TypeScript支持

```ts
interface State {
  count: number
  items: Item[]
  userinfo: UserInfo | null
}

interface UserInfo {
  username: string
  password: string
}

interface Item {
  name: string
  email: string
}

export const useCounterStore = defineStore('counter', {
  state: (): State => ({ count: 0, userinfo: null, items: []}),
  getters: {
    double: (state) => state.count * 2
  },
  actions: {
    increment() {
      this.count++
    }
  }
})

```

